{"version":3,"sources":["assets/mainPack/script/basketBall/Ball/Ball.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UIPControlBase } from './../../../../c2f-framework/gui/layer/UIPControlBase';\nimport { C2FEnum } from './../../../../c2f-framework/define/C2FEnum';\nimport BallModel from './BallModel';\nimport BallView from './BallView';\nimport { EventName } from '../../../../Script/game/EventName';\nimport { UIPa } from '../../../../Script/game/UIParam';\nimport { GameConsts } from '../../../../Script/game/GameConsts';\nimport { UIHelper } from '../../../../Script/game/UIHelper';\nimport BasketBallMain from '../BasketBallMain/BasketBallMain';\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class Ball extends UIPControlBase {\n    /** 预制名 给实例调用 */\n    public prefabName = 'P_Ball';\n\n    public model: BallModel = undefined;\n    public view: BallView = undefined;\n\n    protected onLoad(): void {\n        this.registerOn()\n        this.node['_touchListener'].swallowTouches = false;\n\n    }\n\n    private registerOn() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancelled, this);\n\n\n    }\n\n    private registerOff() {\n        this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancelled, this);\n    }\n    public init(basket: BasketBallMain) {\n        this.model.initData(basket)\n    }\n\n    private onTouchStart(event: any) {\n        this.model.began = event.getLocation();\n        this.model.status = GameConsts.TouchStatus.BEGEN;\n    }\n    private onTouchCancelled(event: any) {\n        this.model.status = GameConsts.TouchStatus.CANCEL;\n    }\n    private onTouchEnd(event) {\n        this.model.ended = event.getLocation();\n        let distance = Math.sqrt(Math.pow((this.model.ended.x - this.model.began.x), 2) + Math.pow((this.model.ended.y - this.model.began.y), 2));\n\n        if (distance > 40 && this.model.began.y < this.model.ended.y) {\n            this.model.status = GameConsts.TouchStatus.ENDED;\n            this.registerOff()\n\n            this.model.currentVerSpeed = this.model.emitSpeed;\n            //记录最后触摸点,根据触摸点偏移计算速度\n            this.model.target = this.node.parent.convertToNodeSpaceAR(this.model.ended);\n            this.model.currentHorSpeed = this.model.target.x * 2;\n            UIHelper.playEffect(\"basketBall/fly\")\n            this.doAnim();\n            c2f.event.emit(EventName.EName.newBall);\n            if (this.model.shadow) {\n                this.model.shadow.dimiss();\n            }\n        } else {\n            this.model.status = GameConsts.TouchStatus.CANCEL;\n        }\n    }\n\n    private doAnim() {\n        let rotateValue = Math.random() * 3 * 360\n        cc.tween(this.node).to(2, { angle: rotateValue }).start()\n        cc.tween(this.node).to(1, { scale: this.model.scale }).start()\n    }\n    /**篮球绑定自己的影子 */\n    public bindShadow(shadow) {\n        this.model.shadow = shadow;\n    }\n    protected update(dt: number): void {\n        if (this.model.status != GameConsts.TouchStatus.ENDED) {\n            return;\n        }\n\n        this.updatePosition(dt);\n        this.checkValid();\n    }\n    private checkValid() {\n        if (this.model.ballStatus !== GameConsts.BallStatus.DOWN || this.model.valid) {\n            return;\n        }\n\n        let parent = this.node.parent;\n        if (parent != null) {\n            let basket = this.model.basket;\n            let left = basket.view.left;\n            let right = basket.view.right;\n            let ballRadius = this.node.getBoundingBoxToWorld().width / 2;\n\n            /** 统一转换成世界坐标计算进球逻辑 */\n            // 篮球的边界和中心\n            let ballLeft = parent.convertToWorldSpaceAR(this.node.getPosition()).x - ballRadius;\n            let ballRight = parent.convertToWorldSpaceAR(this.node.getPosition()).x + ballRadius;\n            let ballX = parent.convertToWorldSpaceAR(this.node.getPosition()).x;\n            let ballY = parent.convertToWorldSpaceAR(this.node.getPosition()).y;\n\n            // 有效进球范围\n            let validTop = parent.convertToWorldSpaceAR(basket.view.line.getPosition()).y - ballRadius;\n            let validLeft = basket.node.convertToWorldSpaceAR(left.getPosition()).x;\n            let validRight = basket.node.convertToWorldSpaceAR(right.getPosition()).x;\n            let validBot = basket.node.convertToWorldSpaceAR(left.getPosition()).y - ballRadius * 2;\n\n            if (ballY < validTop && ballY > validBot && ballX > validLeft && ballX < validRight) {\n                this.model.valid = true;\n                basket.addScore();\n                basket.playNetAnim();\n                if (this.model.hitIn) {\n                    UIHelper.playEffect('basketBall/hitboard');\n                } else {\n                    UIHelper.playEffect('basketBall/hitboardin');\n                }\n            }\n        }\n    }\n    private updatePosition(dt: number) {\n        this.node.x += dt * this.model.currentHorSpeed;\n\n        this.model.currentVerSpeed -= dt * this.model.gravity;\n        this.node.y += dt * this.model.currentVerSpeed;\n\n        this.changeBallStatus(this.model.currentVerSpeed);\n\n        if (this.model.ballStatus === GameConsts.BallStatus.NONE && this.isOutScreen()) {\n            this.node.stopAllActions();\n            this.node.removeFromParent();\n            this.model.valid = false;\n            return;\n        }\n    }\n\n    private isOutScreen() {\n        return this.node.y < -900;\n    }\n    private changeBallStatus(speed: number) {\n        if (speed === 0 || this.isOutScreen()) {\n            this.model.ballStatus = GameConsts.BallStatus.NONE;\n        } else if (speed > 0) {\n            this.model.ballStatus = GameConsts.BallStatus.FLY;\n            this.model.basket.switchMaskLineShow(false);\n        } else {\n            this.model.ballStatus = GameConsts.BallStatus.DOWN;\n            this.model.basket.switchMaskLineShow(true);\n        }\n    }\n\n    onCollisionEnter(other, self) {\n        if (this.model.ballStatus === GameConsts.BallStatus.FLY) { // 篮球上升过程中不进行碰撞检测\n            return;\n        }\n\n        var box = other.node.getComponent('CollisionBox');\n        var left = box.getLeft();\n        var right = box.getRight();\n\n        // 碰撞系统会计算出碰撞组件在世界坐标系下的相关的值，并放到 world 这个属性里面\n        var world = self.world;\n        var radius = world.radius;\n\n        // 换算物体世界坐标系坐标\n        var selfWorldPot = this.node.parent.convertToWorldSpaceAR(self.node.getPosition());\n        var otherWorldPot = this.model.basket.node.convertToWorldSpaceAR(other.node.getPosition());\n\n        // 将碰撞范围抽象成篮筐左右两个点，并将这两点与篮球放到同一个碰撞组。\n        // 篮球中心点到刚体中心点距离除以篮球半径得到一个比值，横纵向乘以这个比值得到横纵向速度。\n        var ratioVer = (selfWorldPot.y - otherWorldPot.y) / radius;\n        var ratioHor = Math.abs(otherWorldPot.x - selfWorldPot.x) / radius;\n        // 水平方向碰撞最大初速度\n        var horV = this.model.currentHorSpeed / Math.abs(this.model.currentHorSpeed) * this.model.maxXSpeed;\n\n        // 篮球碰到篮筐内，改变篮球横向速度为反方向\n        if ((other.node.name === 'right' && this.node.x <= left) || (other.node.name === 'left' && this.node.x >= right)) {\n            if (!this.model.hitIn) {\n                this.model.currentHorSpeed = horV * -1 * ratioHor;\n                this.model.hitIn = true;\n            } else {\n                this.model.currentHorSpeed = horV * ratioHor;\n            }\n        }\n\n        // 篮球碰到篮筐外，增大横向速度\n        if ((other.node.name === 'right' && this.node.x > right) || (other.node.name === 'left' && this.node.x < left)) {\n            this.model.currentHorSpeed = horV;\n        }\n        this.model.currentVerSpeed = this.model.currentVerSpeed * -1 * ratioVer;\n        UIHelper.playEffect('basketBall/hitboard');\n\n        // 碰撞组件的 aabb 碰撞框\n        var aabb = world.aabb;\n\n        // 上一次计算的碰撞组件的 aabb 碰撞框\n        var preAabb = world.preAabb;\n\n        // 碰撞框的世界矩阵\n        var t = world.transform;\n\n        // 以下属性为圆形碰撞组件特有属性\n        var r = world.radius;\n        var p = world.position;\n\n    }\n\n}"]}