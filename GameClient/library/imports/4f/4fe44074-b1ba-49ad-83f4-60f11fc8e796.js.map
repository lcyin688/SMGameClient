{"version":3,"sources":["assets/c2f-framework/gui/layer/DelegateComponent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { C2FEnum } from \"../../define/C2FEnum\";\nimport { ViewParams } from \"../../define/C2FUIDef\";\n\nconst { ccclass } = cc._decorator;\n\n/** 窗口事件触发组件 */\n@ccclass\nexport class DelegateComponent extends cc.Component {\n    /** 视图参数 */\n    viewParams: ViewParams = null!;\n\n    /** 窗口添加 */\n    public add() {\n        // 触发窗口组件上添加到父节点后的事件\n        this.parallelApplyComponentsFunction(this.node, \"onViewOpen\", this.viewParams.params);\n        this.parallelApplyComponentsFunction(this.node, \"playInAnima\", this.viewParams.params);\n        if (typeof this.viewParams.callbacks.onUIAdded === \"function\") {\n            this.viewParams.callbacks.onUIAdded(this.node, this.viewParams.params);\n        }\n        c2f.event.emit(C2FEnum.Event.PopViewAdded, this.node.name);\n    }\n\n    /** 删除节点，该方法只能调用一次，将会触发onUIBeforeRemove回调 */\n    public remove(isDestroy: boolean) {\n        if (this.viewParams.valid) {\n            // 触发窗口组件上移除之前的事件\n            this.parallelApplyComponentsFunction(this.node, \"beforeViewClose\", this.viewParams.params);\n            this.serialApplyComponentsFunction(this.node, \"playOutAnima\", this.viewParams.params, () => {\n                //  通知外部对象窗口组件上移除之前的事件（关闭窗口前的关闭动画处理）\n                if (typeof this.viewParams.callbacks.onUIBeforeRemove === \"function\") {\n                    this.viewParams.callbacks.onUIBeforeRemove(\n                        this.node,\n                        () => {\n                            this.removed(this.viewParams, isDestroy);\n                        });\n                }\n                else {\n                    this.removed(this.viewParams, isDestroy);\n                }\n            });\n        }\n    }\n\n    /** 窗口组件中触发移除事件与释放窗口对象 */\n    private removed(viewParams: ViewParams, isDestroy: boolean) {\n        viewParams.valid = false;\n\n        if (typeof viewParams.callbacks.onUIRemoved === \"function\") {\n            viewParams.callbacks!.onUIRemoved(this.node, viewParams.params);\n        }\n\n        if (isDestroy) {\n            this.node.destroy();\n            //TODO:包名\n            c2f.res.release(viewParams.prefabPath, cc.Prefab, viewParams.bundle);\n        }\n        else {\n            this.node.removeFromParent();\n        }\n        c2f.event.emit(C2FEnum.Event.PopViewRemoved, this.node.name);\n    }\n\n    public onDestroy() {\n        // 触发窗口组件上窗口移除之后的事件\n        this.parallelApplyComponentsFunction(this.node, \"onUIDestroy\", this.viewParams.params);\n\n        // 通知外部对象窗口移除之后的事件\n        if (typeof this.viewParams.callbacks!.onUIDestroy === \"function\") {\n            this.viewParams.callbacks!.onUIDestroy(this.node, this.viewParams.params);\n        }\n\n        this.viewParams = null!;\n    }\n\n    //并行执行\n    protected parallelApplyComponentsFunction(node: cc.Node, funName: string, params: any) {\n        const allComps = node['_components'];\n        for (let i = 0; i < allComps.length; i++) {\n            let component: any = allComps[i];\n            let func = component[funName];\n            if (func) {\n                func.call(component, params);\n            }\n        }\n    }\n\n    //依次执行\n    protected serialApplyComponentsFunction(node: cc.Node, funName: string, params: any, endCb: Function) {\n        let idx = 0;\n        let applyOnce = () => {\n            const allComps = node['_components'];\n            if (idx >= allComps.length) {\n                endCb && endCb();\n            } else {\n                let component: any = allComps[idx];\n                let func = component[funName];\n                if (func) {\n                    func.call(component, params, () => {\n                        idx++;\n                        applyOnce();\n                    });\n                } else {\n                    idx++;\n                    applyOnce();\n                }\n            }\n        }\n        applyOnce();\n    }\n}"]}