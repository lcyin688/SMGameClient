{"version":3,"sources":["assets/c2f-framework/component/ui/animValue/AnimValue.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Easing, SCALE_TWEEN, C2FTween } from \"../../../core/timer/C2FTween\";\n\nconst { ccclass, property, menu, executeInEditMode } = cc._decorator;\n\n/**\n * 数值变化类型\n */\nenum AnimType {\n    /** 以速度计算变化时长 */\n    SPEED,\n    /** 固定时长 */\n    DURATION,\n}\n\n/**\n * 固定时长时的缓动类型\n */\nenum EasingType {\n    NONE,\n    IN,\n    OUT,\n    IN_OUT,\n}\n\n/**\n * 数值渐变组件基类，可根据此组件拓展各种数值渐变的组件\n */\n@ccclass\n@executeInEditMode\n@menu(\"c2f/UI/AnimValue\")\nexport default class AnimValue extends cc.Component {\n    @property private _endValue: number = 0;\n    @property private _curValue: number = 0;\n\n    @property({\n        tooltip: CC_DEV && \"初始值\"\n    })\n    public get initValue(): number { return this._endValue; }\n    public set initValue(v: number) {\n        this._curValue = v;\n        this._endValue = v;\n        this.setValueImmediately(this._endValue);\n    }\n\n    @property({\n        type: cc.Enum(AnimType),\n        tooltip: CC_DEV && \"数值变化类型\\nSPEED：以速度计算变化时长\\nDURATION：固定时长\"\n    })\n    public animType: AnimType = AnimType.SPEED;\n\n    @property({\n        tooltip: CC_DEV && \"每秒数值变化速度\",\n        visible() { return this.animType === AnimType.SPEED; }\n    })\n    public speed: number = 1;\n\n    @property({\n        tooltip: CC_DEV && \"数值变化的总时长\",\n        visible() { return this.animType === AnimType.DURATION; }\n    })\n    public duration: number = 1;\n\n    @property({\n        type: cc.Enum(EasingType),\n        tooltip: CC_DEV && \"变化的缓动类型\"\n    })\n    public easingType: EasingType = EasingType.NONE;\n\n    @property({\n        tooltip: CC_DEV && \"变化速度是否受到timeScale的影响\"\n    })\n    public timeScale: boolean = false;\n\n    /** 缓存动画的resolve */\n    private _animResolve: (value: void | PromiseLike<void>) => void;\n    private _tween: C2FTween<this> = null;\n    private _isAdd: boolean = false;\n    /** 当前是否为增量变化 */\n    public get isAdd(): boolean { return this._isAdd; }\n\n    /** 变化的目标值 */\n    public get endValue(): number { return this._endValue; }\n    /** 变化过程的当前值 */\n    public get curValue(): number { return this._curValue; }\n\n    /**\n     * @virtual\n     */\n    protected onAnimStart(): void {\n    }\n\n    /**\n     * @virtual\n     */\n    protected onAnimUpdate(): void {\n    }\n\n    /**\n     * @virtual\n     */\n    protected onAnimComplete(): void {\n        if (this._animResolve) {\n            this._animResolve();\n            this._animResolve = null;\n        }\n        if (this._tween) {\n            this._tween.stop();\n            this._tween = null;\n        }\n    }\n\n    /**\n     * 立即设置value，不执行动画\n     * @virtual\n     */\n    protected setValueImmediately(end: number): void {\n        this._isAdd = this._endValue - this._curValue > 0;\n        this._endValue = end;\n        this._curValue = end;\n        this.onAnimStart();\n        this.onAnimUpdate();\n        this.onAnimComplete();\n    }\n\n    /**\n     * 设置进度值。进度动画结束后resolve\n     * @virtual\n     * @param end 目标进度值\n     * @param anim 是否执行动画，默认true\n     */\n    public setValue(end: number, anim: boolean = true): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!anim) {\n                this.setValueImmediately(end);\n                resolve();\n                return;\n            }\n\n            this._animResolve = resolve;\n            this._endValue = end;\n            this._isAdd = this._endValue - this._curValue > 0;\n            this._tween?.stop();\n            this._tween = this.timeScale ? new C2FTween(this, SCALE_TWEEN) : new C2FTween(this);\n            let duration = this.animType === AnimType.DURATION ? this.duration : Math.abs(this._endValue - this._curValue) / this.speed;\n            switch (this.easingType) {\n                case EasingType.IN:\n                    this._tween.easing(Easing.Quadratic.In);\n                    break;\n                case EasingType.OUT:\n                    this._tween.easing(Easing.Quadratic.Out);\n                    break;\n                case EasingType.IN_OUT:\n                    this._tween.easing(Easing.Quadratic.InOut);\n                    break;\n                default:\n                    break;\n            }\n            this._tween.to({ _curValue: this._endValue }, duration * 1000)\n                .onStart(() => {\n                    this.onAnimStart();\n                })\n                .onUpdate(() => {\n                    this.onAnimUpdate();\n                })\n                .onComplete(() => {\n                    this.onAnimComplete();\n                })\n                .start();\n        });\n    }\n\n    /**\n     * 停止动画，并中止之前未结束的Promise\n     * @virtual\n     */\n    public stop(): void {\n        if (this._animResolve) {\n            this._animResolve = null;\n        }\n        if (this._tween) {\n            this._tween.stop();\n            this._tween = null;\n        }\n    }\n}\n"]}