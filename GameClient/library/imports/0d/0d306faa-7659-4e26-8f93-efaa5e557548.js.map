{"version":3,"sources":["assets/c2f-framework/component/ui/multiTexture/assembler/MultiAssemblerBarFilled.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import MultiAssembler from \"./MultiAssembler\";\n\nexport default class MultiAssemblerBarFilled extends MultiAssembler {\n    public updateRenderData(sprite) {\n        let frame = sprite._spriteFrame;\n        this.packToDynamicAtlas(sprite, frame);\n\n        if (!sprite._vertsDirty) {\n            return;\n        }\n\n        let fillStart = sprite._fillStart;\n        let fillRange = sprite._fillRange;\n\n        if (fillRange < 0) {\n            fillStart += fillRange;\n            fillRange = -fillRange;\n        }\n\n        fillRange = fillStart + fillRange;\n\n        fillStart = fillStart > 1.0 ? 1.0 : fillStart;\n        fillStart = fillStart < 0.0 ? 0.0 : fillStart;\n\n        fillRange = fillRange > 1.0 ? 1.0 : fillRange;\n        fillRange = fillRange < 0.0 ? 0.0 : fillRange;\n        fillRange = fillRange - fillStart;\n        fillRange = fillRange < 0 ? 0 : fillRange;\n\n        let fillEnd = fillStart + fillRange;\n        fillEnd = fillEnd > 1 ? 1 : fillEnd;\n\n        this.updateUVs(sprite, fillStart, fillEnd);\n        this.updateVerts(sprite, fillStart, fillEnd);\n        this.updateTextureIdx(sprite);\n\n        sprite._vertsDirty = false;\n    }\n\n    public updateUVs(sprite, fillStart, fillEnd) {\n        let spriteFrame = sprite._spriteFrame;\n\n        //build uvs\n        let atlasWidth = spriteFrame._texture.width;\n        let atlasHeight = spriteFrame._texture.height;\n        let textureRect = spriteFrame._rect;\n        //uv computation should take spritesheet into account.\n        let ul, vb, ur, vt;\n        let quadUV0, quadUV1, quadUV2, quadUV3, quadUV4, quadUV5, quadUV6, quadUV7;\n        if (spriteFrame._rotated) {\n            ul = (textureRect.x) / atlasWidth;\n            vb = (textureRect.y + textureRect.width) / atlasHeight;\n            ur = (textureRect.x + textureRect.height) / atlasWidth;\n            vt = (textureRect.y) / atlasHeight;\n\n            quadUV0 = quadUV2 = ul;\n            quadUV4 = quadUV6 = ur;\n            quadUV3 = quadUV7 = vb;\n            quadUV1 = quadUV5 = vt;\n        }\n        else {\n            ul = (textureRect.x) / atlasWidth;\n            vb = (textureRect.y + textureRect.height) / atlasHeight;\n            ur = (textureRect.x + textureRect.width) / atlasWidth;\n            vt = (textureRect.y) / atlasHeight;\n\n            quadUV0 = quadUV4 = ul;\n            quadUV2 = quadUV6 = ur;\n            quadUV1 = quadUV3 = vb;\n            quadUV5 = quadUV7 = vt;\n        }\n\n        let verts = this._renderData.vDatas[0];\n        let uvOffset = this.uvOffset;\n        let floatsPerVert = this.floatsPerVert;\n        switch (sprite._fillType) {\n            case cc.Sprite.FillType.HORIZONTAL:\n                verts[uvOffset] = quadUV0 + (quadUV2 - quadUV0) * fillStart;\n                verts[uvOffset + 1] = quadUV1 + (quadUV3 - quadUV1) * fillStart;\n                verts[uvOffset + floatsPerVert] = quadUV0 + (quadUV2 - quadUV0) * fillEnd;\n                verts[uvOffset + floatsPerVert + 1] = quadUV1 + (quadUV3 - quadUV1) * fillEnd;\n                verts[uvOffset + floatsPerVert * 2] = quadUV4 + (quadUV6 - quadUV4) * fillStart;\n                verts[uvOffset + floatsPerVert * 2 + 1] = quadUV5 + (quadUV7 - quadUV5) * fillStart;\n                verts[uvOffset + floatsPerVert * 3] = quadUV4 + (quadUV6 - quadUV4) * fillEnd;\n                verts[uvOffset + floatsPerVert * 3 + 1] = quadUV5 + (quadUV7 - quadUV5) * fillEnd;\n                break;\n            case cc.Sprite.FillType.VERTICAL:\n                verts[uvOffset] = quadUV0 + (quadUV4 - quadUV0) * fillStart;\n                verts[uvOffset + 1] = quadUV1 + (quadUV5 - quadUV1) * fillStart;\n                verts[uvOffset + floatsPerVert] = quadUV2 + (quadUV6 - quadUV2) * fillStart;\n                verts[uvOffset + floatsPerVert + 1] = quadUV3 + (quadUV7 - quadUV3) * fillStart;\n                verts[uvOffset + floatsPerVert * 2] = quadUV0 + (quadUV4 - quadUV0) * fillEnd;\n                verts[uvOffset + floatsPerVert * 2 + 1] = quadUV1 + (quadUV5 - quadUV1) * fillEnd;\n                verts[uvOffset + floatsPerVert * 3] = quadUV2 + (quadUV6 - quadUV2) * fillEnd;\n                verts[uvOffset + floatsPerVert * 3 + 1] = quadUV3 + (quadUV7 - quadUV3) * fillEnd;\n                break;\n            default:\n                cc[\"errorID\"](2626);\n                break;\n        }\n    }\n\n    public updateVerts(sprite, fillStart, fillEnd) {\n        let node = sprite.node,\n            width = node.width, height = node.height,\n            appx = node.anchorX * width, appy = node.anchorY * height;\n\n        let l = -appx, b = -appy,\n            r = width - appx, t = height - appy;\n\n        let progressStart, progressEnd;\n        switch (sprite._fillType) {\n            case cc.Sprite.FillType.HORIZONTAL:\n                progressStart = l + (r - l) * fillStart;\n                progressEnd = l + (r - l) * fillEnd;\n\n                l = progressStart;\n                r = progressEnd;\n                break;\n            case cc.Sprite.FillType.VERTICAL:\n                progressStart = b + (t - b) * fillStart;\n                progressEnd = b + (t - b) * fillEnd;\n\n                b = progressStart;\n                t = progressEnd;\n                break;\n            default:\n                cc[\"errorID\"](2626);\n                break;\n        }\n\n        let local = this._local;\n        local[0] = l;\n        local[1] = b;\n        local[2] = r;\n        local[3] = t;\n\n        this.updateWorldVerts(sprite);\n    }\n}\n"]}