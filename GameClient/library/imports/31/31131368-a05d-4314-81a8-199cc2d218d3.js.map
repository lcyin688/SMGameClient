{"version":3,"sources":["assets/mainPack/script/physics2048/Physics2048Item/Physics2048Item.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UIPControlBase } from './../../../../c2f-framework/gui/layer/UIPControlBase';\nimport Physics2048ItemModel from './Physics2048ItemModel';\nimport Physics2048ItemView from './Physics2048ItemView';\nimport { UIPa } from '../../../../Script/game/UIParam';\nimport { UIHelper } from '../../../../Script/game/UIHelper';\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class Physics2048Item extends UIPControlBase {\n    /** 预制名 给实例调用 */\n    public prefabName = 'P_Physics2048Item';\n\n    public model: Physics2048ItemModel = undefined;\n    public view: Physics2048ItemView = undefined;\n    private isInit = false\n    private rigidBody: cc.RigidBody;\n    private collider: cc.PhysicsCircleCollider;\n\n\n    private init() {\n        if (!this.isInit) {\n            this.rigidBody = this.node.getComponent(cc.RigidBody)\n            this.collider = this.node.getComponent(cc.PhysicsCircleCollider)\n            this.isInit = true\n        }\n    }\n\n\n    public setInit(data: UIPa.Physics2048ItemArgs, callBack: Function) {\n        this.init()\n        this.model.initData(data, callBack)\n        this.initView(data)\n    }\n\n    private initView(data: UIPa.Physics2048ItemArgs) {\n        c2f.utils.view.changeSpriteFrame(this.view.iconSprite, data.url)\n        let radius = data.radius\n        this.collider.radius = radius\n        this.collider.tag = data.tag\n        this.setRigidBodyEnabledContactListener(true)\n        this.node.active = false\n        this.scheduleOnce(() => {\n            this.node.setContentSize(radius * 1.8, radius * 1.8)\n            this.node.active = true\n        })\n    }\n    public setRigidBodyEnabledContactListener(state: boolean) {\n        if (this.rigidBody) {\n            this.rigidBody.enabledContactListener = state\n        }\n    }\n    public setRigidBodyType(type: cc.RigidBodyType) {\n        if (this.rigidBody) {\n            this.rigidBody.type = type\n        }\n    }\n\n\n    onBeginContact(contact: cc.PhysicsContact, collider1: cc.PhysicsCollider, collider2: cc.PhysicsCollider) {\n        if (collider2.tag == collider1.tag && collider2.tag >= UIPa.PhysicsTag.block_2) {\n            if (collider2.node) {\n                let item2 = collider2.node.getComponent(Physics2048Item)\n                if (item2) {\n                    if (item2.model.data) {\n                        if (item2.model.data.tag < UIPa.PhysicsTag.block_2048) {\n                            let item1 = collider1.node.getComponent(Physics2048Item)\n                            if (item1) {\n                                //找出主动碰撞的对象移动的快的是主动碰的\n                                contact.disabled = true;\n                                if (item1.rigidBody.linearVelocity.mag() > item2.rigidBody.linearVelocity.mag()) {\n                                    this.hitFun(item2, item1, contact)\n                                } else {\n                                    this.hitFun(item1, item2, contact)\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**item1 被动的需要被删除\n     * item2 主动的需要保留\n     */\n    private hitFun(item1: Physics2048Item, item2: Physics2048Item, contact: cc.PhysicsContact) {\n        item1.setRigidBodyEnabledContactListener(false)\n        item1.collider.enabled = false\n        item1.node.group = \"ui\"\n        if (item1.rigidBody) {\n            item1.rigidBody.linearVelocity = cc.Vec2.ZERO; // 清除线性速度\n            item1.rigidBody.angularVelocity = 0 // 清除角速度\n            item1.rigidBody.gravityScale = 0\n            item1.rigidBody.angularVelocity = 0\n            item1.rigidBody.fixedRotation = true\n        }\n        let itemData = UIPa.Physics2048ItemData[item2.model.data.tag]\n        cc.tween(item1.node).to(0.2, { scale: 0.1 }).call(() => {\n            item1.node.active = false\n            item1.node.destroy()\n            contact.disabled = false;\n            if (item2.rigidBody.linearVelocity.y <= 0) {\n                const force = new cc.Vec2(0, -0.2)\n                item2.rigidBody.applyForceToCenter(force, true)\n            }\n            this.playWinSound(itemData.tag)\n        }).start()\n        let callFun = () => {\n            //如果到了2048 就需要消除掉\n            if (item2.model.data.tag == UIPa.PhysicsTag.block_2048) {\n                item2.node.active = false\n                item2.node.destroy()\n            }\n        }\n        item2.setInit(itemData, this.model.cbFun)\n        if (this.model.cbFun) {\n            this.model.cbFun(itemData, item2.node, callFun)\n        }\n    }\n    private playWinSound(tag: number) {\n        if (tag == UIPa.PhysicsTag.block_1024) {\n            UIHelper.playEffect(\"physics2048binggeSuper\")\n        } else if (tag == UIPa.PhysicsTag.block_512) {\n            UIHelper.playEffect(\"physics2048binggeBan\")\n        } else if (tag == UIPa.PhysicsTag.block_256) {\n            UIHelper.playEffect(\"physics2048binggeCool\")\n        } else if (tag == UIPa.PhysicsTag.block_128) {\n            UIHelper.playEffect(\"physics2048binggeNice\")\n        }\n    }\n\n}"]}