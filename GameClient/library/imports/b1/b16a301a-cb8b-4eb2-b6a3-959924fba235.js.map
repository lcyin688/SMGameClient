{"version":3,"sources":["assets/c2f-framework/component/ui/scrollList/CircleList.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property, executeInEditMode, menu } = cc._decorator;\n\n/** 初始角度 */\nconst INIT_DEGREE: number = 270;\n\n/**\n * 环形列表，将节点以椭圆排列\n */\n@ccclass\n@executeInEditMode\n@menu(\"c2f/UI/CircleList\")\nexport default class CircleList extends cc.Component {\n    @property(cc.Node)\n    private content: cc.Node = null;\n    @property({ tooltip: CC_DEV && \"椭圆长短轴\" })\n    private ellipseAxes: cc.Vec2 = cc.v2(0, 0);\n    @property({ tooltip: CC_DEV && \"列表自动滚动的速度\" })\n    private scrollSpeed: number = 200;\n\n    private _init: boolean = false;\n    private _curDegree: number = INIT_DEGREE;\n    private _targetDegree: number = INIT_DEGREE;\n    private _scrolling: boolean = false;\n    private _itemDegreeMap: Map<cc.Node, number> = new Map();\n    private _maxDelta: number = 0;\n    /** 子节点被选中时的回调 */\n    private _selectCall: (item: cc.Node) => void = null;\n\n    /** 虚拟角度，子节点会根据角度计算坐标 */\n    public get curDegree(): number { return this._curDegree; }\n    public set curDegree(v: number) {\n        this._curDegree = c2f.utils.math.normalizeDegree(v);\n        this.refreshItems();\n    }\n\n    /**\n     * 初始化列表，按角度均匀排列content所有子节点\n     * @param selectCall \n     */\n    public init(selectCall: (item: cc.Node) => void = null): void {\n        this._init = true;\n        this._scrolling = false;\n        this._maxDelta = 0;\n        this._itemDegreeMap.clear();\n        this._selectCall = selectCall;\n        if (this.content.childrenCount <= 0) {\n            return;\n        }\n        let average: number = 360 / this.content.childrenCount;\n        this.content.children.forEach((v, i) => {\n            this._itemDegreeMap.set(v, i * average);\n\n            v.on(cc.Node.EventType.TOUCH_MOVE, this.itemTouchMove, this);\n            v.on(cc.Node.EventType.TOUCH_END, this.itemTouchEnd, this);\n            v.on(cc.Node.EventType.TOUCH_CANCEL, this.itemTouchEnd, this);\n        });\n        this.refreshItems();\n    }\n\n    /**\n     * 滚动到指定子节点处\n     * @param item 子节点\n     */\n    public scrollToItem(item: cc.Node): void {\n        if (!this._itemDegreeMap.has(item)) {\n            return;\n        }\n\n        let itemDegree = this._itemDegreeMap.get(item);\n        let delta = INIT_DEGREE - itemDegree;\n        this._targetDegree = c2f.utils.math.normalizeDegree(delta);\n        this._scrolling = true;\n        this._selectCall?.(item);\n    }\n\n    private refreshItems(): void {\n        this.content.children.forEach((v, i) => {\n            let degree = c2f.utils.math.normalizeDegree(this._itemDegreeMap.get(v) + this.curDegree);\n            let pos = c2f.utils.vec.getEllipsePoint(this.ellipseAxes.x, this.ellipseAxes.y, degree);\n            v.setPosition(pos);\n            v.zIndex = -v.y;\n        });\n    }\n\n    protected update(dt: number): void {\n        if (!this._init || !this._scrolling || this.curDegree === this._targetDegree) {\n            return;\n        }\n\n        let delta = Math.abs(this._targetDegree - this.curDegree);\n        let degree = this.curDegree;\n        let sign = (delta < 180 ? 1 : -1) * Math.sign(this._targetDegree - this.curDegree);\n        degree += dt * this.scrollSpeed * sign;\n\n        if ((this.curDegree > this._targetDegree && degree < this._targetDegree) || (this.curDegree < this._targetDegree && degree > this._targetDegree)) {\n            degree = this._targetDegree;\n            this._scrolling = false;\n        }\n        this.curDegree = degree;\n    }\n\n    private itemTouchMove(event: cc.Event.EventTouch): void {\n        let delta = event.getDeltaX();\n        if (Math.abs(delta) < 1) {\n            return;\n        }\n\n        if (this._maxDelta < Math.abs(delta)) {\n            this._maxDelta = Math.abs(delta);\n        }\n        this.curDegree = this.curDegree + delta / 5;\n    }\n\n    private itemTouchEnd(event: cc.Event.EventTouch): void {\n        let node = event.target;\n        if (this._maxDelta < 5) {\n            this._maxDelta = 0;\n            this.scrollToItem(node);\n            return;\n        }\n\n        let minDelta = 360;\n        let minNode = this.content.children[0];\n        for (let i = 0; i < this.content.children.length; i++) {\n            const item = this.content.children[i];\n            let itemDegree = c2f.utils.math.normalizeDegree(this._itemDegreeMap.get(item) + this.curDegree);\n            let delta = Math.abs(INIT_DEGREE - itemDegree);\n            if (delta > 180) {\n                delta = itemDegree + 360 - INIT_DEGREE;\n            }\n            if (delta < minDelta) {\n                minDelta = delta;\n                minNode = item;\n            }\n        }\n        this._maxDelta = 0;\n        this.scrollToItem(minNode);\n    }\n}\n"]}