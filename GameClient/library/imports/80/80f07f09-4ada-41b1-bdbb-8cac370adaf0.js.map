{"version":3,"sources":["assets/c2f-framework/component/animation/UIAnimaPlayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UIAnimaTarget, UIAnimaType } from \"../../define/UIAnimaDef\";\n\nconst { ccclass, property } = cc._decorator;\n\n\n@ccclass\nexport class UIAnimaPlayer extends cc.Component {\n\n    @property(UIAnimaTarget)\n    animaTarget: UIAnimaTarget[] = [];\n\n    @property()\n    playOnload: boolean = false;\n\n    private beforePlayOpacity: Map<cc.Node, number> = null;\n\n    protected onLoad(): void {\n        //需要动画的节点透明化\n        this.beforePlayOpacity = new Map();\n        for (let one of this.animaTarget) {\n            this.beforePlayOpacity.set(one.tarNode, one.tarNode.opacity);\n            one.tarNode.opacity = 1;\n        }\n    }\n\n    protected start(): void {\n        if (this.playOnload) {\n            this.scheduleOnce(this.play.bind(this), 0)\n        }\n    }\n\n    public play() {\n        //还原透明度\n        this.beforePlayOpacity.forEach((v, k) => {\n            k.opacity = v;\n        })\n        this.beforePlayOpacity.clear();\n\n        // 初始化目标对象状态 \n        this.initTargetState();\n        //播放动作\n        for (let one of this.animaTarget) {\n            this.playTargetAnima(one);\n        }\n    }\n\n    /** 初始化目标状态 */\n    private initTargetState() {\n        for (let one of this.animaTarget) {\n            this.initTarget(one);\n        }\n    }\n\n    /** 初始化 */\n    private initTarget(target: UIAnimaTarget) {\n        for (let one of target.actionList) {\n            for (let oneCH of one.animaList) {\n                switch (oneCH.animaTp) {\n                    case UIAnimaType.move:\n                        target.tarNode.x -= oneCH.byVec2.x;\n                        target.tarNode.y -= oneCH.byVec2.y;\n                        break;\n                    case UIAnimaType.opacity:\n                        target.tarNode.opacity -= oneCH.byNum;\n                        break;\n                    case UIAnimaType.ratation:\n                        target.tarNode.rotation -= oneCH.byNum;\n                        break;\n                    case UIAnimaType.scale:\n                        target.tarNode.scaleX -= oneCH.byVec2.x;\n                        target.tarNode.scaleY -= oneCH.byVec2.y;\n                        break;\n                }\n            }\n        }\n    }\n\n    private playTargetAnima(target: UIAnimaTarget) {\n        let sequence = [];\n        for (let one of target.actionList) {\n            let onceParam: any = null;\n            for (let oneCH of one.animaList) {\n                if (oneCH.animaTp == UIAnimaType.delay) {\n                    sequence.push(cc.tween(target.tarNode).delay(one.duration));\n                } else if (oneCH.animaTp == UIAnimaType.function) {\n                    sequence.push(cc.tween(target.tarNode).call(() => {\n                        if (!oneCH.cbHandler.tarNode) {\n                            return;\n                        }\n                        let comp = oneCH.cbHandler.tarNode.getComponent(oneCH.cbHandler.compName);\n                        if (!comp) {\n                            return;\n                        }\n                        comp[oneCH.cbHandler.funcName]();\n                    }));\n                } else {\n                    onceParam = onceParam || {};\n                    switch (oneCH.animaTp) {\n                        case UIAnimaType.move:\n                            onceParam.x = oneCH.byVec2.x;\n                            onceParam.y = oneCH.byVec2.y;\n                            break;\n                        case UIAnimaType.opacity:\n                            onceParam.opacity = oneCH.byNum;\n                            break;\n                        case UIAnimaType.ratation:\n                            onceParam.rotation = oneCH.byNum;\n                            break;\n                        case UIAnimaType.scale:\n                            onceParam.scaleX = oneCH.byVec2.x;\n                            onceParam.scaleY = oneCH.byVec2.y;\n                            break;\n                    }\n                }\n            }\n            if (onceParam) {\n                sequence.push(cc.tween(target.tarNode).by(one.duration, onceParam));\n            }\n        }\n        if (sequence.length <= 0) {\n            return;\n        }\n        let evalStr = 'cc.tween(target.tarNode)';\n        for (let i = 0; i < sequence.length; i++) {\n            evalStr += `.then(sequence[${i}])`;\n        }\n        evalStr += '.start();';\n        eval(evalStr);\n    }\n}\n"]}