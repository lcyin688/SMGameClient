{"version":3,"sources":["assets/mainPack/script/mapCreate/MapCreateMain/MapCreateMain.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UIVControlBase } from './../../../../c2f-framework/gui/layer/UIVControlBase';\nimport { C2FEnum } from './../../../../c2f-framework/define/C2FEnum';\nimport MapCreateMainModel from './MapCreateMainModel';\nimport MapCreateMainView from './MapCreateMainView';\nimport MapCreatItem from '../MapCreatItem/MapCreatItem';\nimport { GameConsts } from '../../../../Script/game/GameConsts';\nimport { UIPa } from '../../../../Script/game/UIParam';\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class MapCreateMain extends UIVControlBase {\n    /** 预制名 给实例调用 */\n    public prefabName = 'F_MapCreateMain';\n\n    public model: MapCreateMainModel = undefined;\n    public view: MapCreateMainView = undefined;\n\n    protected onLoad(): void {\n        this.view.tabGroupTabPage.quickSetTabHnadler(this, \"CC_onTabPageClick\");\n        // 添加鼠标按下事件监听器\n        this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onMouseDown, this);\n        this.node.on(cc.Node.EventType.MOUSE_UP, this.onMouseUp, this);\n\n\n    }\n\n    protected onViewOpen(param: any) {\n        this.getCurData()\n        this.loadTabItemFirst(this.startGame.bind(this))\n\n    }\n\n\n    protected onEnable(): void {\n        if (super.onEnable) {\n            super.onEnable();\n        }\n        this.on(C2FEnum.UIEvent.ButtonClick, this.onButtonClick, this);\n    }\n\n    protected onDisable(): void {\n        if (super.onDisable) {\n            super.onDisable();\n        }\n        this.off(C2FEnum.UIEvent.ButtonClick);\n    }\n\n    private async onButtonClick(eventType: string, component: cc.Button) {\n        switch (component.name) {\n\n            case this.view.btnSaveButton.name:\n                this.CC_onClickbtnSave();\n                break;\n\n            case this.view.btnNewButton.name:\n                this.CC_onClickbtnNew();\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    private CC_onClickbtnSave() {\n        let content = this.getStarAllData(this.model.curLv)\n        const fileName = \"guanQiaTest.txt\";\n        this.downloadTxtFile(content, fileName);\n    }\n\n    private downloadTxtFile(content, fileName) {\n        // 创建一个新的 Blob 对象，传入文件的内容和 MIME 类型\n        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });\n        // 创建一个隐藏的可下载链接\n        const link = document.createElement('a');\n        link.href = URL.createObjectURL(blob);\n        link.download = fileName;\n        link.style.display = 'none';\n        // 将链接添加到页面中并触发点击事件\n        document.body.appendChild(link);\n        link.click();\n        // 清理\n        document.body.removeChild(link);\n        URL.revokeObjectURL(link.href);\n    }\n\n\n    //读取配置中的元素\n    private getStarAllData(index: number) {\n        let str = \"\"\n        let arr: number[][] = this.model.starDataArr\n        str += \"[\" + index + \"]: [\\n\"\n        for (let col = 0; col < 10; col++) {\n            str += \"[\"\n            for (let row = 0; row < 10; row++) {\n                str += arr[col][row] + \",\"\n            }\n            if (col < 9) {\n                str += \"],\\n\"\n            } else {\n                str += \"]\\n\"\n            }\n\n        }\n        str += \"],\\n\"\n        return str\n    }\n\n    private CC_onClickbtnNew() {\n        this.getCurData()\n        this.startGame()\n    }\n\n\n    private CC_onTabPageClick(subName: string) {\n        if (this.model.curSelect == subName) {\n            return;\n        }\n        this.model.curSelect = subName\n    }\n\n\n    private getCurData() {\n        this.model.curLv = this.getCurLv()\n        this.model.initData();\n    }\n\n    private getCurLv() {\n        let lv = 0\n        if (this.view.editBoxEditBox.string && this.view.editBoxEditBox.string != \"\") {\n            lv = parseInt(this.view.editBoxEditBox.string)\n        }\n        return lv\n    }\n\n    public async loadTabItemFirst(cb) {\n        await c2f.res.loadOne(GameConsts.CmmPrefab.mapCreatItem, cc.Prefab).then((resItem: cc.Prefab) => {\n            this.model.blockItem = resItem;\n            if (cb) {\n                cb();\n            }\n        })\n    }\n\n    private startGame() {\n        if (!this.model.starItemMap) {\n            this.initItemArr()\n        }\n        for (let row = 0; row < 10; row++) {\n            for (let column = 0; column < 10; column++) {\n                let initPosition = this.model.getStarPosition(row, column);\n                let item = this.model.starItemMap.get(row).get(column);\n                let nodeItem = item.node\n                nodeItem.name = `block${column}_${row}`\n                nodeItem.setPosition(initPosition);\n                let typ = this.model.starDataArr[row][column]\n                let itemData = UIPa.StarItemData[typ]\n                let score = 0\n                let url = \"\"\n                if (itemData) {\n                    score = itemData.score\n                    url = itemData.url\n                }\n                let dataItem: UIPa.DesStarItemArgs = {\n                    typ: typ,\n                    score: score,\n                    url: url,\n                    column: column,\n                    row: row,\n                    cbFun: this.clickItemCb.bind(this),\n                }\n                item.setInit(dataItem);\n            }\n        }\n    }\n    private initItemArr() {\n        this.model.starItemMap = new Map();\n        for (let row = 0; row < 10; row++) {\n            let mapItem: Map<number, MapCreatItem> = new Map()\n            for (let column = 0; column < 10; column++) {\n                let nodeItem = c2f.utils.view.instantiateMVCPrefab(this.model.blockItem, this.view.content);\n                this.view.content.addChild(nodeItem)\n                let blockItem = nodeItem.getComponent(MapCreatItem)\n                mapItem.set(column, blockItem)\n            }\n            this.model.starItemMap.set(row, mapItem)\n        }\n    }\n\n    private clickItemCb(data: UIPa.DesStarItemArgs) {\n        let item = this.model.starItemMap.get(data.row).get(data.column);\n        let score = 0\n        let url = \"\"\n        let typ = this.model.getCurIndex()\n        let itemData = UIPa.StarItemData[typ]\n        if (itemData) {\n            score = itemData.score\n            url = itemData.url\n        }\n        data.typ = typ\n        data.score = score\n        data.url = url\n        item.setInit(data);\n        this.model.starDataArr[data.row][data.column] = typ\n    }\n\n    // 鼠标按下事件处理器\n    private onMouseDown(event) {\n        szg.player.public.isMouseDown = true\n    }\n\n    private onMouseUp(event) {\n        szg.player.public.isMouseDown = false\n    }\n\n\n\n}"]}