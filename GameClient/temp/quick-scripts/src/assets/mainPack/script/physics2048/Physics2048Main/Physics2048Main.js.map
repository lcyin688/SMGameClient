{"version":3,"sources":["assets/mainPack/script/physics2048/Physics2048Main/Physics2048Main.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UIVControlBase } from './../../../../c2f-framework/gui/layer/UIVControlBase';\nimport { C2FEnum } from './../../../../c2f-framework/define/C2FEnum';\nimport Physics2048MainModel from './Physics2048MainModel';\nimport Physics2048MainView from './Physics2048MainView';\nimport { UIHelper } from '../../../../Script/game/UIHelper';\nimport { EntranceUI } from '../../../../entrance/script/EntranceView';\nimport { GameConsts } from '../../../../Script/game/GameConsts';\nimport Physics2048Item from '../Physics2048Item/Physics2048Item';\nimport { UIPa } from '../../../../Script/game/UIParam';\nimport { GameHelper } from '../../../../Script/game/GameHelper';\nimport BoomItem from '../BoomItem/BoomItem';\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class Physics2048Main extends UIVControlBase {\n    /** 预制名 给实例调用 */\n    public prefabName = 'F_Physics2048Main';\n\n    public model: Physics2048MainModel = undefined;\n    public view: Physics2048MainView = undefined;\n\n\n\n    protected onLoad(): void {\n        this.initAudioState()\n        UIHelper.playMusic('physics2048BackMusic');\n        GameHelper.setPhysics(true)\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node['_touchListener'].swallowTouches = false;\n    }\n    private initAudioState() {\n        let state = c2f.storage.getBoolean(GameConsts.StorageKey.soundBg)\n        c2f.audio.bgmOff = state;\n        let stateEff = c2f.storage.getBoolean(GameConsts.StorageKey.soundEff)\n        c2f.audio.sfxOff = stateEff;\n    }\n    private onTouchStart(event) {\n        if (!this.model.isCanCreateNew) {\n            this.setBlockItemPos(event)\n        }\n    }\n    private onTouchMove(event) {\n        if (!this.model.isCanCreateNew) {\n            this.setBlockItemPos(event)\n        }\n    }\n\n    private onTouchEnd(event) {\n        if (!this.model.isCanCreateNew) {\n            this.setBlockItemPos(event)\n            this.playFallingAni()\n        }\n    }\n\n    private setBlockItemPos(event) {\n        if (this.model.physics2048Item) {\n            let worldPoint = event.getLocation();\n            let posInNode = this.view.content.convertToNodeSpaceAR(worldPoint);\n            this.model.physics2048Item.node.x = posInNode.x\n        }\n    }\n\n    private playFallingAni() {\n        UIHelper.playEffect('physics2048click');\n        if (this.model.physics2048Item) {\n            this.model.totalScore += this.model.physics2048Item.model.data.score\n            this.model.physics2048Item.setRigidBodyType(cc.RigidBodyType.Dynamic)\n            this.model.physics2048Item = null\n            this.reflashScore()\n            //表演下落\n            this.scheduleOnce(() => {\n                this.model.isCanCreateNew = true\n                this.foreceCreateNewItem()\n            }, 2)\n        }\n    }\n\n    private reflashScore() {\n        this.view.txtTotalScoreLabel.string = \"Score:{0}\".format(this.model.totalScore)\n    }\n\n    protected onViewOpen(param: any) {\n        this.model.initData()\n        this.reflashScore()\n        this.loadTabItemFirst(this.startView.bind(this))\n        c2f.res.loadOne(GameConsts.CmmPrefab.boomItem, cc.Prefab).then((resItem: cc.Prefab) => {\n            this.model.boomItem = resItem;\n        })\n\n    }\n\n\n    protected onEnable(): void {\n        if (super.onEnable) {\n            super.onEnable();\n        }\n        this.on(C2FEnum.UIEvent.ButtonClick, this.onButtonClick, this);\n    }\n\n    protected onDisable(): void {\n        if (super.onDisable) {\n            super.onDisable();\n        }\n        this.off(C2FEnum.UIEvent.ButtonClick);\n    }\n\n    private async onButtonClick(eventType: string, component: cc.Button) {\n        switch (component.name) {\n\n            case this.view.btnMenuButton.name:\n                this.CC_onClickbtnMenu();\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    private CC_onClickbtnMenu() {\n        UIHelper.playEffect('betClick');\n        // c2f.gui.open(EntranceUI.SoundSet)\n\n        c2f.gui.open(EntranceUI.GameLogin)\n        this.closeView()\n    }\n    public async loadTabItemFirst(cb) {\n        await c2f.res.loadOne(GameConsts.CmmPrefab.physics2048Item, cc.Prefab).then((resItem: cc.Prefab) => {\n            this.model.blockItem = resItem;\n            if (cb) {\n                cb();\n            }\n        })\n    }\n\n    private startView() {\n        this.foreceCreateNewItem()\n\n    }\n\n    private foreceCreateNewItem() {\n        this.model.isCanCreateNew = true\n        this.createNewItem()\n    }\n\n    private createNewItem() {\n        if (!this.model.isCanCreateNew) {\n            return\n        }\n        this.model.isCanCreateNew = false\n        this.randomNewItem()\n    }\n\n    private randomNewItem() {\n        let index = this.model.rodomOneIndex()\n        let nodeItem = c2f.utils.view.instantiateMVCPrefab(this.model.blockItem, this.view.content);\n        this.view.content.addChild(nodeItem)\n        let blockItem = nodeItem.getComponent(Physics2048Item)\n        this.model.physics2048Item = blockItem\n        let startItem = this.view.initPos\n        let world = startItem.parent.convertToWorldSpaceAR(startItem.getPosition());\n        let space = nodeItem.parent.convertToNodeSpaceAR(world);\n        nodeItem.setPosition(space)\n        let itemData = UIPa.Physics2048ItemData[index]\n        blockItem.setInit(itemData, this.callBack.bind(this))\n        blockItem.setRigidBodyType(cc.RigidBodyType.Static)\n        //设置左上角当前元素\n        c2f.utils.view.changeSpriteFrame(this.view.iconMaxSprite, itemData.url)\n        this.view.txtCurScoreLabel.string = \"X{0}\".format(itemData.score)\n\n\n    }\n\n    private callBack(data: UIPa.Physics2048ItemArgs, startItem: cc.Node, cbFun: Function) {\n        let nodeItem = c2f.utils.view.instantiateMVCPrefab(this.model.boomItem, this.view.effect);\n        this.view.effect.addChild(nodeItem)\n        let boomItem = nodeItem.getComponent(BoomItem)\n        let world = startItem.parent.convertToWorldSpaceAR(startItem.getPosition());\n        let space = nodeItem.parent.convertToNodeSpaceAR(world);\n        nodeItem.setPosition(space)\n        boomItem.playBoom(data, () => {\n            cbFun()\n        })\n\n    }\n\n}"]}