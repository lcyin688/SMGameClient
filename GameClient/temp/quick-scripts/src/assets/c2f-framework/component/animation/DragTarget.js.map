{"version":3,"sources":["assets/c2f-framework/component/animation/DragTarget.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n@ccclass\nexport default class DragTarget extends cc.Component {\n\n    @property(cc.Node)\n    target: cc.Node = null;\n\n    private startPos: cc.Vec2 = null;\n    private currtPos: cc.Vec2 = null;\n    private dragEndCb: Function = null;\n\n    protected onEnable(): void {\n        if (super.onEnable) {\n            super.onEnable();\n        }\n        // 监听触摸事件\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\n    }\n\n    protected onDisable(): void {\n        if (super.onDisable) {\n            super.onDisable();\n        }\n        this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\n    }\n\n    private onTouchStart(event: cc.Event.EventTouch): void {\n        this.currtPos = this.target.getPosition();\n        this.startPos = this.currtPos.clone();\n    }\n\n    private onTouchMove(event: cc.Event.EventTouch): void {\n        let delta = event.getDelta();\n        this.currtPos.x = this.currtPos.x + delta.x;\n        this.currtPos.y = this.currtPos.y + delta.y;\n        this.target.setPosition(this.currtPos);\n    }\n\n    private onTouchEnd(event: cc.Event.EventTouch): void {\n        this.onDragEnd(event);\n    }\n\n    private onTouchCancel(event: cc.Event.EventTouch): void {\n        this.onDragEnd(event);\n    }\n\n    private onDragEnd(event: cc.Event.EventTouch) {\n        if (cc.Vec2.distance(this.currtPos, this.startPos) > 20) {\n            event.stopPropagation();\n            this.dragEndCb && this.dragEndCb();\n\n            let btn = this.target.getComponent(cc.Button);\n            if (btn) {\n                btn['_onTouchCancel']();\n            }\n        }\n    }\n\n    public setDragEndCb(endCb: Function) {\n        this.dragEndCb = endCb;\n    }\n}"]}