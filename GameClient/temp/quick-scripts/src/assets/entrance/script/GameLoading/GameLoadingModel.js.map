{"version":3,"sources":["assets/entrance/script/GameLoading/GameLoadingModel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameConsts } from '../../../Script/game/GameConsts';\nimport { C2FEnum } from '../../../c2f-framework/define/C2FEnum';\nimport { UIModelBase } from './../../../c2f-framework/gui/layer/UIModelBase';\n\ninterface InputData {\n    type: GameConsts.LoadingType;\n    endCb: Function;\n    param: any;\n}\n\nenum LoadKind {\n    csv = 1,        //策划配置\n    json = 2,       //其他配置\n    homeView,       //主界面\n    RedDot,         //红点系统\n    ResidentRes,    //常驻资源\n    batBullet,      //战斗子弹资源\n    batMonster,     //战斗僵尸\n    batHero,        //战斗英雄\n    batEffect,      //战斗特效\n    batBg,          //战斗背景\n    batRoom,        //房间资源\n    batAudio,       //战斗音乐音效\n    battleView,     //战斗界面\n}\n\nclass TaskInfo {\n    kind: LoadKind;\n    data: any;\n}\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class GameLoadingModel extends UIModelBase {\n    /** 预制名 给实例调用 */\n    public prefabName = 'GameLoading';\n\n    private _input: InputData;\n    public get input(): InputData {\n        return this._input;\n    }\n    public set input(v: InputData) {\n        this._input = v;\n    }\n\n    public loadTask() {\n        switch (this.input.type) {\n            case GameConsts.LoadingType.home:\n                this.loadCfgFiles(this.updateProgInfo.bind(this), this.onConfigLoadEnd.bind(this));\n                break;\n            case GameConsts.LoadingType.battle:\n                this.loadBattleRes(this.input.param, this.updateProgInfo.bind(this), this.onTaskEnd.bind(this));\n                break;\n        }\n    }\n\n    private updateProgInfo(prog: number, tips: string = '') {\n        this.emit(C2FEnum.Event.ChangeViewValue, 'barLoadingProgressBar', (barLoading: cc.ProgressBar) => {\n            barLoading.progress = prog;\n        });\n        this.emit(C2FEnum.Event.ChangeViewValue, 'progressLabel', (progressLabel: cc.Label) => {\n            progressLabel.string = (prog * 100).toFixed(1) + '%';;\n        });\n        this.emit(C2FEnum.Event.ChangeViewValue, 'noticeTopLabel', (noticeTopLabel: cc.Label) => {\n            noticeTopLabel.string = tips;\n        });\n    }\n\n    private onConfigLoadEnd() {\n        szg.player.cfgLoaded = true;\n        //配置加载完成是直接进主界面还是有需求直接进战斗什么的，可在这里分支\n        this.loadHomeViewRes(this.updateProgInfo.bind(this), this.onTaskEnd.bind(this));\n    }\n\n    private async onTaskEnd() {\n        this.input && this.input.endCb && this.input.endCb();\n    }\n\n    //任务·加载游戏配置\n    public loadCfgFiles(progCb: Function, cmplCb: Function) {\n        let arrTask = [\n            { kind: LoadKind.csv, data: null },\n            { kind: LoadKind.json, data: null }\n        ]\n        this.doLineTask(arrTask, progCb, cmplCb);\n    }\n\n    //任务·加载主界面\n    public loadHomeViewRes(progCb: Function, cmplCb: Function) {\n        let arrTask = [\n            { kind: LoadKind.RedDot, data: null },\n            { kind: LoadKind.homeView, data: null },\n            { kind: LoadKind.ResidentRes, data: null }\n        ]\n        this.doLineTask(arrTask, progCb, cmplCb);\n    }\n\n    //任务·加载战斗资源\n    public loadBattleRes(director: any, progCb: Function, cmplCb: Function) {\n        let arrTask: TaskInfo[] =\n            [\n                { kind: LoadKind.batBullet, data: director },\n                { kind: LoadKind.batMonster, data: director },\n                { kind: LoadKind.batHero, data: director },\n                { kind: LoadKind.batEffect, data: director },\n                { kind: LoadKind.batBg, data: director },\n                { kind: LoadKind.batRoom, data: director },\n                { kind: LoadKind.batAudio, data: director },\n                { kind: LoadKind.battleView, data: director },\n            ];\n        this.doLineTask(arrTask, progCb, cmplCb);\n    }\n\n    //单线执行任务\n    private doLineTask(arrTask: TaskInfo[], progCb: Function, cmplCb: Function) {\n        let taskFuncs: Function[] = this.getTaskFuncList(arrTask);\n        let taskCnt = taskFuncs.length;\n\n        if (taskCnt <= 0) {\n            cmplCb && cmplCb();\n        } else {\n            let idx = 0;\n            let oneTaskCmpl = () => {\n                idx++;\n                runTask();\n            }\n            let oneTaskProg = (cur: number, total: number) => {\n                let beginProg = idx / taskCnt;\n                let step = 1 / taskCnt;\n                let subProg = cur / total;\n                let totalProg = beginProg + step * subProg;\n                progCb && progCb(totalProg);\n                if (cur >= total) {\n                    oneTaskCmpl();\n                }\n            }\n            let runTask = () => {\n                if (idx >= taskFuncs.length) {\n                    //所有任务已完成\n                    cmplCb && cmplCb();\n                } else {\n                    taskFuncs[idx](arrTask[idx].data, oneTaskProg)\n                }\n            }\n            runTask();\n        }\n    }\n\n    //加载函数列表\n    private getTaskFuncList(arrTask: TaskInfo[]) {\n        let funcList: Function[] = [];\n        for (let one of arrTask) {\n            switch (one.kind) {\n                case LoadKind.csv:\n                    funcList.push(this.loadCSV.bind(this));\n                    break;\n                case LoadKind.json:\n                    funcList.push(this.loadJSON.bind(this));\n                    break;\n                case LoadKind.RedDot:\n                    funcList.push(this.initRedDot.bind(this));\n                    break;\n                case LoadKind.homeView:\n                    funcList.push(this.loadHomeView.bind(this));\n                    break;\n                case LoadKind.ResidentRes:\n                    funcList.push(this.loadResidentRes.bind(this));\n                    break;\n                case LoadKind.batBullet:\n                    funcList.push(this.loadBattleBullet.bind(this));\n                    break;\n                case LoadKind.batMonster:\n                    funcList.push(this.loadBattleMonster.bind(this));\n                    break;\n                case LoadKind.batHero:\n                    funcList.push(this.loadBattleHero.bind(this));\n                    break;\n                case LoadKind.batEffect:\n                    funcList.push(this.loadBattleEffect.bind(this));\n                    break;\n                case LoadKind.batRoom:\n                    funcList.push(this.loadBattleRooms.bind(this));\n                    break;\n                case LoadKind.batBg:\n                    funcList.push(this.loadBattleBg.bind(this));\n                    break;\n                case LoadKind.batAudio:\n                    funcList.push(this.loadBattleAudio.bind(this));\n                    break;\n                case LoadKind.battleView:\n                    funcList.push(this.loadBattleView.bind(this));\n                    break;\n            }\n        }\n        return funcList;\n    }\n\n    //具体实现·加载配置\n    private loadCSV(data: any, progCb: Function) {\n        szg.cfg.loadAllCSV((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        });\n    }\n\n    //具体实现·加载配置\n    private loadJSON(data: any, progCb: Function) {\n        szg.cfg.loadAllJson((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        });\n    }\n\n    //具体实现·加载主界面预制\n    private loadHomeView(data: any, progCb: Function) {\n        let { ResidentResMgr } = require('ResidentResMgr');\n        ResidentResMgr.ins.loadGameHomePrefab((prefab: cc.Prefab) => {\n            progCb && progCb(1, 1);\n        })\n    }\n\n    //具体实现·初始化红点\n    private initRedDot(data: any, progCb: Function) {\n        let { ResidentResMgr } = require('ResidentResMgr');\n        ResidentResMgr.ins.loadRedDotPrefab((prefab: cc.Prefab) => {\n            szg.player.redDot.initRedDot(prefab);\n            progCb && progCb(1, 1);\n        })\n    }\n\n    //具体实现·加载常驻资源\n    private loadResidentRes(data: any, progCb: Function) {\n        let total = 2;\n        let curV = 0;\n        let loadedOnce = () => {\n            progCb && progCb(curV, total);\n        }\n        let { ResidentResMgr } = require('ResidentResMgr');\n        ResidentResMgr.ins.loadBattleStartSpine((spDt: sp.SkeletonData) => {\n            curV++;\n            loadedOnce();\n        })\n        ResidentResMgr.ins.initMainTeamRes(() => {\n            curV++;\n            loadedOnce();\n        })\n    }\n\n    //具体实现·加载战斗子弹\n    private loadBattleBullet(director: any, progCb: Function) {\n        director.preloadBulletRes((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n    //具体实现·加载战斗僵尸\n    private loadBattleMonster(director: any, progCb: Function) {\n        director.preloadMonsterRes((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n    //具体实现·加载战斗英雄\n    private loadBattleHero(director: any, progCb: Function) {\n        director.preloadHeroRes((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n    //具体实现·加载战斗特效\n    private loadBattleEffect(director: any, progCb: Function) {\n        director.preloadEffectRes((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n    //具体实现·加载战斗界面预制\n    private loadBattleView(data: any, progCb: Function) {\n        // const uiCfg = ViewCfgData[UIID.BattleView];\n        // YT.res.load(GameConsts.Bundle.battle, uiCfg.prefab, Prefab, (err, res) => {\n        //     progCb && progCb(1, 1);\n        // })\n    }\n\n    //具体实现·加载战斗房间预制体\n    private loadBattleRooms(director: any, progCb: Function) {\n        director.preloadBatBg((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n    //具体实现·加载战斗背景图片资源\n    private loadBattleBg(director: any, progCb: Function) {\n        director.preloadRoomFrames((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n    //具体实现·加载战斗音乐音效\n    private loadBattleAudio(director: any, progCb: Function) {\n        director.preloadAudioRes((cur: number, total: number) => {\n            progCb && progCb(cur, total);\n        })\n    }\n\n\n}"]}